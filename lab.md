# Лабораторная работа: Управление процессами

В данной лабораторной работе мы познакомимся с основными инструментами и командами для управления процессами в Linux. Мы научимся просматривать запущенные процессы, останавливать и возобновлять их, управлять приоритетами, а также поймем принцип взаимодействия со службами системы.

## Часть 1. Объяснительный пример

### Шаги для понимания

**Примерная задача:** Предположим, у нас запущен долгий процесс (например, бесконечный цикл вывода текста в терминал), и мы хотим приостановить его, продолжить позже, а затем завершить.

1. **Создание скрипта для долгого процесса.**  
   Создадим скрипт `long_process.sh`, который бесконечно выводит строки в терминал:
   ```bash
   #!/bin/bash
   while true
   do
       echo "Процесс работает..."
       sleep 2
   done
   ```
   
   Сохраняем скрипт и даем ему права на исполнение:
   ```bash
   chmod +x long_process.sh
   ```

2. **Запуск процесса.**  
   Запускаем скрипт в терминале:
   ```bash
   ./long_process.sh
   ```
   
   Терминал будет каждые 2 секунды выводить строку "Процесс работает...".

3. **Приостановка процесса.**  
   Для приостановки процесса в текущем терминале нажмите клавиши `Ctrl+Z`.
   
   После этого терминал сообщит, что процесс остановлен (stopped).

4. **Просмотр списка процессов.**  
   Используем команду `ps` или `jobs` для просмотра процессов:
   ```bash
   jobs
   ```
   Вы увидите, что наш скрипт имеет статус `Stopped`.

5. **Возобновление процесса в фоне.**  
   Чтобы возобновить процесс в фоне (чтобы терминал был доступен для команд), используем команду:
   ```bash
   bg %1
   ```
   Теперь процесс продолжит работу, но терминал не будет "занят" процессом.

6. **Просмотр PID и приоритетов.**  
   Чтобы узнать PID (идентификатор процесса), используем:
   ```bash
   ps aux | grep long_process.sh
   ```
   Здесь вы увидите PID процесса.

   Для просмотра приоритетов можно использовать команду `top` или `htop` (при наличии), где будут указаны PID, CPU%, MEM%, а также PRI (приоритет).

7. **Изменение приоритета процесса (nice/renice).**  
   Допустим, вы хотите снизить приоритет процесса. Узнайте PID процесса (допустим, это 1234) и выполните:
   ```bash
   renice +5 1234
   ```
   Это увеличит число nice, тем самым снизив приоритет.

8. **Завершение процесса.**  
   Чтобы остановить процесс окончательно, используйте команду:
   ```bash
   kill 1234
   ```
   или, если процесс "упрямится":
   ```bash
   kill -9 1234
   ```

Таким образом, мы познакомились с базовыми операциями: старт, пауза, возобновление, просмотр, изменение приоритетов и остановка процесса.

---

## Часть 2. Практическое задание

### Задача

Написать и выполнить сценарий, который:

1. Запускает три разных процесса:
   - Первый процесс: бесконечно пишет в файл `output1.log` дату и время каждые 3 секунды.
   - Второй процесс: бесконечно выводит в терминал случайные числа каждые 5 секунд.
   - Третий процесс: бесконечно пишет в файл `output2.log` строку `"Hello from process 3"` каждые 2 секунды.
   
2. После запуска этих трех процессов необходимо:
   - Найти их PID.
   - Приостановить второй процесс, возобновить его в фоне через 10 секунд.
   - Изменить приоритет третьего процесса, чтобы он выполнялся с более низким приоритетом (например, `nice` +10).
   - После 30 секунд работы всех трех процессов – завершить их.
   
3. Результатом вашей работы должен быть скрипт `process_control.sh`, который автоматизирует все вышеперечисленные действия. Скрипт должен:
   - Запускать три процесса (их можно запускать через `&` для фона или через отдельные терминальные команды `nohup`).
   - Определять PID всех трех процессов (подсказка: можно использовать `pgrep` с уникальными именами или поиском по команде).
   - Выполнять приостановку, возобновление, изменение приоритета и остановку процессов автоматически.
   
4. Проверить, что скрипт корректно отрабатывает все шаги и прикрепить скриншоты терминала с выводом команд.

### Подсказки

- Для записи даты и времени в файл:
  ```bash
  while true
  do
      date >> output1.log
      sleep 3
  done
  ```
- Для генерации случайного числа каждые 5 секунд:
  ```bash
  while true
  do
      echo $RANDOM
      sleep 5
  done
  ```
- Для записи "Hello from process 3" в файл `output2.log` каждые 2 секунды:
  ```bash
  while true
  do
      echo "Hello from process 3" >> output2.log
      sleep 2
  done
  ```

- Управление приоритетами: `nice`, `renice`.
- Приостановка и возобновление процессов: `kill -STOP PID`, `kill -CONT PID`.
- Остановка процессов: `kill PID`.

### Как успешно сдать работу?

1. Создайте репозиторий, используя "Use this template" из предоставленных преподавателем шаблонов, или самостоятельно инициализируйте репозиторий.
2. В вашем репозитории создайте файл `README.md` и скопируйте туда данную инструкцию.
3. Добавьте скриншоты работы скрипта и выводов команд.
4. Выложите сам скрипт `process_control.sh`.
5. В отчете опишите:
   - Как вы запускали процессы.
   - Как определили их PID.
   - Какими командами приостановили, возобновили и изменили приоритет.
   - Какие команды использовали для завершения процессов.
   
Для защиты вам необходимо уметь объяснить, как работает управление процессами в Linux, что такое приоритет процессов, как изменить приоритет, как приостановить и возобновить процессы. 

### Дополнительные материалы

- `man ps`  
- `man kill`  
- `man nice` и `man renice`  
- [Linux Processes Explained (англ.)](https://tldp.org/LDP/intro-linux/html/sect_05_01.html)  
- [Статья о приоритетах процессов (рус.)](https://habr.com/ru/post/537040/)  
- Google, StackOverflow

---
